{
    "$schema": "https://vega.github.io/schema/vega/v5.json",
    "description": "A basic grouped bar chart example.",
    "width": 900,
    "height": 1200,
    "padding": 5,
  
    "data": [
      {
        "name": "table",
        "values": [
      {
          "group": "Signed by appropriate person",
          "url": "https://wikirate.org/Business_Human_Rights_Resource_Centre+MSA_statement_signed?filter%5Bvalue%5D%5B%5D=Signed%20by%20CEO&filter%5Bvalue%5D%5B%5D=Signed%20by%20Director&filter%5Bvalue%5D%5B%5D=Signed%20by%20Managing%20Director&filter%5Bvalue%5D%5B%5D=Signed%20by%20Chairman",
          "category": "UK",
          "value": 72,
          "color": "#189AB4",
          "mandatory": "Yes"
      },
      {
          "group": "Signed by appropriate person",
          "url": "https://wikirate.org/Business_Human_Rights_Resource_Centre+MSA_statement_signed?filter%5Bvalue%5D%5B%5D=Signed%20by%20CEO&filter%5Bvalue%5D%5B%5D=Signed%20by%20Director&filter%5Bvalue%5D%5B%5D=Signed%20by%20Managing%20Director&filter%5Bvalue%5D%5B%5D=Signed%20by%20Chairman",
          "category": "Australian",
          "value": 89,
          "color": "#D4F1F4",
          "mandatory": "Yes"
      },
      {
          "group": "Signed by appropriate person",
          "url": "https://wikirate.org/Business_Human_Rights_Resource_Centre+MSA_statement_signed?filter%5Bvalue%5D%5B%5D=Signed%20by%20CEO&filter%5Bvalue%5D%5B%5D=Signed%20by%20Director&filter%5Bvalue%5D%5B%5D=Signed%20by%20Managing%20Director&filter%5Bvalue%5D%5B%5D=Signed%20by%20Chairman",
          "category": "Both",
          "value": 79,
          "color": "#000029"
      },
      {
          "group": "Board approval",
          "url": "https://wikirate.org/Business_Human_Rights_Resource_Centre+MSA_Statement_Approval?filter%5Bvalue%5D%5B%5D=Approved%20by%20Board",
          "category": "UK",
          "value": 70,
          "color": "#189AB4",
          "mandatory": "Yes"
      },
      {
          "group": "Board approval",
          "url": "https://wikirate.org/Business_Human_Rights_Resource_Centre+MSA_Statement_Approval?filter%5Bvalue%5D%5B%5D=Approved%20by%20Board",
          "category": "Australian",
          "value": 94,
          "color": "#D4F1F4",
          "mandatory": "Yes"
      },
      {
          "group": "Board approval",
          "url": "https://wikirate.org/Business_Human_Rights_Resource_Centre+MSA_Statement_Approval?filter%5Bvalue%5D%5B%5D=Approved%20by%20Board",
          "category": "Both",
          "value": 78,
          "color": "#000029"
      },
      {
          "group": "Statement publication",
          "url": "https://wikirate.org/Walk_Free+MSA_Statement_Publication?filter%5Bvalue%5D%5B%5D=Yes",
          "category": "UK",
          "value": 34,
          "color": "#189AB4",
          "mandatory": "Yes"
      },
      {
          "group": "Statement publication",
          "url": "https://wikirate.org/Walk_Free+MSA_Statement_Publication?filter%5Bvalue%5D%5B%5D=Yes",
          "category": "Australian",
          "value": 87,
          "color": "#D4F1F4",
          "mandatory": "Yes"
      },
      {
          "group": "Statement publication",
          "url": "https://wikirate.org/Walk_Free+MSA_Statement_Publication?filter%5Bvalue%5D%5B%5D=Yes",
          "category": "Both",
          "value": 45,
          "color": "#000029"
      },
      {
          "group": "Consultation process",
          "url": "https://wikirate.org/Walk_Free+MSA_Consultation_Process?filter%5Bvalue%5D%5B%5D=Yes",
          "category": "UK",
          "value": null,
          "color": "#189AB4",
          "mandatory": "No"
      },
      {
          "group": "Consultation process",
          "url": "https://wikirate.org/Walk_Free+MSA_Consultation_Process?filter%5Bvalue%5D%5B%5D=Yes",
          "category": "Australian",
          "value": 66,
          "color": "#D4F1F4",
          "mandatory": "Yes"
      },
      {
          "group": "Consultation process",
          "url": "https://wikirate.org/Walk_Free+MSA_Consultation_Process?filter%5Bvalue%5D%5B%5D=Yes",
          "category": "Both",
          "value": null,
          "color": "#000029"
      }
  ],
  "transform": [{ "type": "formula", "expr": "if(datum.mandatory == 'Yes',datum.value+'%*',if(datum.value=='N/A','',datum.value+'%'))","as": "string_value" }]
      }
    ],
  
    "scales": [
      {
        "name": "yscale",
        "type": "band",
        "domain": {"data": "table", "field": "group"},
        "range": "height",
        "padding": 0.2
      },
      {
        "name": "xscale",
        "type": "linear",
        "domain": {"data": "table", "field": "value"},
        "range": "width",
        "round": true,
        "zero": true,
        "nice": true
      }
    ],
  
    "axes": [
      {"orient": "left", "scale": "yscale", "tickSize": 0, "labelPadding": 4, "zindex": 1, "labelFontSize": 16, "labelFont":"Rubik"},
      {"orient": "bottom", "scale": "xscale"}
    ],
  
    "marks": [
      {
        "type": "group",
        "from": {
          "facet": {
            "data": "table",
            "name": "facet",
            "groupby": "group"
          }
        },
  
        "encode": {
          "enter": {
            "y": {"scale": "yscale", "field": "group"}
          }
        },
  
        "signals": [
          {"name": "height", "update": "bandwidth('yscale')"}
        ],
  
        "scales": [
          {
            "name": "pos",
            "type": "band",
            "range": "height",
            "domain": {"data": "facet", "field": "category"}
          }
        ],
  
        "marks": [
          {
            "name": "bars",
            "from": {"data": "facet"},
            "type": "rect",
            "encode": {
              "enter": {
                "cornerRadiusTopRight":{"value": 5},
                "cornerRadiusBottomRight":{"value": 5},
                "stroke":{"value":"#fff"},
                "y": {"scale": "pos", "field": "category"},
                "height": {"scale": "pos", "band": 1},
                "x": {"scale": "xscale", "field": "value"},
                "x2": {"scale": "xscale", "value": 0},
                "fill": {"field": "color"}
              },
              "hover":{
                "tooltip":{"signal": "{title: datum.group, 'Legislation': datum.category,'Coverage': if(datum.value=='N/A','Not Applicable',datum.value+'%'), 'Mandatory': datum.mandatory}"}
              }
            }
          },
          {
            "type": "text",
            "from": {"data": "bars"},
            "encode": {
              "enter": {
                "x": {"field": "x2", "offset": -5},
                "y": {"field": "y", "offset": {"field": "height", "mult": 0.6}},
                "fill": [
                  {"test": "contrast('white', datum.fill) > contrast('black', datum.fill)", "value": "white"},
                  {"value": "black"}
                ],
                "align": {"value": "right"},
                "baseline": {"value": "middle"},
                "text": {"field": "datum.string_value"}
              }
            }
          }
        ]
      }
    ]
  }
  